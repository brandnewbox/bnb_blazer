- blazer_title @dashboard.name
%nav.navbar.navbar-default.navbar-fixed-top
  .container
    .navbar-header
      %button.navbar-toggle.collapsed{"aria-expanded" => "false", "data-target" => "#navbar-collapse", "data-toggle" => "collapse", :type => "button"}
        %span.sr-only Toggle navigation
        %span.icon-bar
        %span.icon-bar
        %span.icon-bar
      = image_tag "bnb_intel_logo.png", class: "img-responsive"
    #navbar-collapse.collapse.navbar-collapse
      %ul.nav.navbar-nav
        .btn-group
          = link_to "Home", root_path, class: "btn btn-default", data: { type: "button" }
          %button.btn.btn-default.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :type => "button"}
            %span.caret
            %span.sr-only Toggle Dropdown
          %ul.dropdown-menu
            %li= link_to "Checks", checks_path
            - if Blazer.uploads?
              %li= link_to "Uploads", uploads_path
            %li.divider{role: "separator"}
            %li= link_to "New Query", new_query_path
            %li= link_to "New Dashboard", new_dashboard_path
            - check_params = @query ? {query_id: @query.id} : {}
            %li= link_to "New Check", new_check_path(check_params)

      %ul.nav.navbar-nav.navbar-right
        %li= link_to "Edit", edit_dashboard_path(@dashboard, variable_params(@dashboard))
%div{:style => "margin-bottom: 70px;"}
%h3.text-center=@dashboard.name
- if @data_sources.any? { |ds| ds.cache_mode != "off" }
  %p.text-muted{:style => "float: right;"}
    Some queries may be cached
    \#{link_to "Refresh", refresh_dashboard_path(@dashboard, variable_params(@dashboard)), method: :post}
- if @bind_vars.any?
  = render partial: "blazer/variables", locals: {action: dashboard_path(@dashboard)}
- else
  %div{:style => "padding-bottom: 15px;"}
- @queries.each_with_index do |query, i|
  .chart-container
    %h4= link_to query.friendly_name, query_path(query, variable_params(query)), target: "_blank"
    .chart{:id => "chart-#{i}"}
      %p.text-muted Loading...
  :javascript
    #{blazer_js_var "data", {statement: @statements[i], query_id: query.id, data_source: query.data_source, only_chart: true, cohort_period: params[:cohort_period]}}

    runQuery(data, function (data) {
      $("#chart-#{i}").html(data)
      $("#chart-#{i} table").stupidtable(stupidtableCustomSettings)
    }, function (message) {
      $("#chart-#{i}").addClass("query-error").html(message)
    });
