- blazer_title @query.name
%nav.navbar.navbar-default
  .container
    .navbar-header
      %button.navbar-toggle.collapsed{"aria-expanded" => "false", "data-target" => "#bs-example-navbar-collapse-1", "data-toggle" => "collapse", :type => "button"}
        %span.sr-only Toggle navigation
        %span.icon-bar
        %span.icon-bar
        %span.icon-bar
      .navbar-brand
        = image_tag "bnb_intel_logo.png", class: "img-responsive"
    / Collect the nav links, forms, and other content for toggling
    #bs-example-navbar-collapse-1.collapse.navbar-collapse
      %ul.nav.navbar-nav
        %li.dropdown
          %a.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :href => "#", :role => "button"}
            Dropdown
            %span.caret
          %ul.dropdown-menu
            %li
              %a{:href => "#"} Action
            %li
              %a{:href => "#"} Another action
            %li
              %a{:href => "#"} Something else here
            %li.divider{:role => "separator"}
            %li
              %a{:href => "#"} Separated link
            %li.divider{:role => "separator"}
            %li
              %a{:href => "#"} One more separated link
      %ul.nav.navbar-nav.navbar-right
        %li
          %a{:href => "#"} Link
-# .topbar
-#   .container
-#     .row{:style => "padding-top: 13px;"}
-#       .col-sm-6
-#         = render partial: "blazer/nav"
-#         %h3{:style => "line-height: 34px; display: inline; margin-left: 5px;"}
-#           = @query.name
-#       .col-sm-3.text-right
-#         = link_to "Edit", edit_query_path(@query, variable_params(@query)), class: "text-muted font-weight-bold px-1", disabled: !@query.editable?(blazer_user)
-#         = link_to "Fork", new_query_path(variable_params(@query).merge(fork_query_id: @query.id, data_source: @query.data_source, name: @query.name)), class: "text-muted font-weight-bold px-1"
-#         - if !@error && @success
-#           = link_to "Download", run_queries_path(query_id: @query.id, format: "csv", forecast: params[:forecast], cohort_period: params[:cohort_period]), params: {statement: @statement}, class: "text-muted font-weight-bold px-1"
-#       .col-sm-3.text-right
-#         = image_tag "bnb_intel_logo.png", class: "img-responsive"
#blazer-content
  %div{:style => "margin-bottom: 70px;"}
  - if @sql_errors.any?
    .alert.alert-danger
      %ul
        - @sql_errors.each do |message|
          %li= message
  - if @query.description.present?
    %p= @query.description
  = render partial: "blazer/variables", locals: {action: query_path(@query)}
  %pre#code
    %code= @statement
  - if @success
    #results
      %p.text-muted.text-uppercase Loading...
    :javascript
      function showRun(data) {
        $("#results").html(data)
        $("#results table").stupidtable(stupidtableCustomSettings).stickyTableHeaders({fixedOffset: 60})
      }

      function showError(message) {
        $("#results").addClass("query-error").html(message)
      }

      #{blazer_js_var "data", variable_params(@query).merge(statement: @statement, query_id: @query.id, data_source: @query.data_source)}
      
            runQuery(data, showRun, showError)
  - unless %w(mongodb).include?(Blazer.data_sources[@query.data_source].adapter)
    :javascript
      // do not highlight really long queries
      // this can lead to performance issues
      if ($("code").text().length < 10000) {
        hljs.highlightBlock(document.getElementById("code"));
      }
